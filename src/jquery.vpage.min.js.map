{"version":3,"sources":["jquery.vpage.js"],"names":["$","version","vpage","storage","is_listen","api","this","is_set_listen","console","log","check_param","param","undefined","url","name","event","onload","onpop","err","auto_set_url","usethis","get","tagName","href","attr","set","add_state","state","vpage_name","key","history","get_url_param","window","onpopstate","obj","call","push_state","pushState","title","sPageURL","location","search","substring","sURLVariables","split","i","length","sParameterName","listen","trigger","type","val","fn","on","prepare","jQuery"],"mappings":"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","file":"jquery.vpage.min.js","sourcesContent":["(function ( $ ) {\r\n\r\n    var version = \"1.0.1\";\r\n\r\n    $.vpage = {};\r\n    $.vpage.storage = {}\r\n    $.vpage.is_listen = false;\r\n\r\n    $.vpage.api = new function (){\r\n\r\n        // 設定監聽了？\r\n        this.is_set_listen = function (){\r\n            if ($.vpage.is_listen === false) {\r\n                console.log('vpage 還未設定 listen() ');\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        // 確認參數的合法性\r\n        this.check_param = function (param){\r\n            try {\r\n\r\n                // 禁止輸入 url \r\n                if (param.url !== undefined) throw '請勿指定參數 param.url';\r\n                else if (param.name === undefined) throw '請指定參數 param.name';\r\n                else if (param.event === undefined) throw '請指定參數 param.event';\r\n                else if (param.do === undefined) throw '請指定參數 param.do';\r\n                else if (param.onload === undefined) throw '請指定參數 param.onload';\r\n                else if (param.onpop === undefined) throw '請指定參數 param.onpop';\r\n\r\n\r\n            } catch (err){\r\n                console.log('Error: ' + err);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // 如果是標籤 a 就自動設定網址\r\n        this.auto_set_url = function (usethis, name){\r\n            if ($(usethis).get(0).tagName != \"A\") return false;\r\n            var href = $(usethis).attr(\"href\");\r\n\r\n\r\n            $.vpage.set(name, \"url\", href);\r\n            return href;\r\n        }\r\n\r\n        // 添加新的辨識\r\n        this.add_state = function (param){\r\n            if (!param.state) param.state = {};\r\n            param.state.vpage_name = param.name;\r\n            return param.state;\r\n        }\r\n\r\n        // 取得堆中的 vpage 名稱\r\n        this.key = function (){\r\n            return history.state.vpage_name;\r\n        }\r\n\r\n        \r\n\r\n        /**\r\n         * 畫面進入時所觸發的事件\r\n         * 若要被觸發這個事件，網址需要夾帶有 GET 參數 \"onload\"，值需要指定 vpage 的 name 參數。\r\n         */\r\n        this.onload = function (){\r\n\r\n            // 取得 GET 的 onload 值，作為辨識的鍵\r\n            var vpage_name = $.vpage.get_url_param(\"onload\");\r\n            if (vpage_name) {\r\n\r\n                //呼叫對應的 onload()\r\n                if ($.vpage.storage[vpage_name] !== undefined) {\r\n                    $.vpage.storage[vpage_name].onload();\r\n                }\r\n            }\r\n\r\n            return $.vpage.api;\r\n        }\r\n\r\n        /**\r\n         * 切換上下頁面所觸發的事件\r\n         */\r\n        this.onpop = function (){\r\n\r\n            window.onpopstate  = function (event){\r\n                //如果有放入堆疊的話才執行\r\n                if (history.state && history.state.vpage_name){\r\n                    var key = $.vpage.api.key();\r\n                    var obj = $.vpage.storage[key];\r\n                    obj.onpop.call();\r\n\r\n                }\r\n                else {\r\n                    // 不應該進入這個判斷。\r\n                    console.log('System Error.');\r\n                }\r\n                \r\n            }\r\n            return $.vpage.api;\r\n        }\r\n\r\n        // 將參數放置到 history.state 紀錄\r\n        this.push_state = function (param){\r\n            param.state = $.vpage.api.add_state(param);\r\n            history.pushState(param.state, param.title, param.url);\r\n        }\r\n\r\n    }\r\n\r\n    // 版本\r\n    $.vpage.version = function (){\r\n        return version;\r\n    }\r\n\r\n    // 取得網址的 get 參數，例如 ?\r\n    $.vpage.get_url_param = function (key){\r\n        var sPageURL = window.location.search.substring(1);\r\n        var sURLVariables = sPageURL.split('&');\r\n        for (var i = 0; i < sURLVariables.length; i++){\r\n            var sParameterName = sURLVariables[i].split('=');\r\n            if (sParameterName[0] == key){\r\n                return sParameterName[1];\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 監聽 vpage 設定的 onload 與 onpop 事件，\r\n     * 須要放置在所有的 vpage 最後。\r\n     */\r\n    $.vpage.listen = function(){\r\n        $.vpage.is_listen = true;\r\n        $.vpage.api.onload();\r\n        $.vpage.api.onpop();\r\n    }\r\n\r\n    /**\r\n     * 由外部手動觸發\r\n     * @param   name         vpage 的名稱\r\n     * @param   type         onload | onpop\r\n     */\r\n    $.vpage.trigger = function (name, type){\r\n        if (type == \"onload\"){\r\n            $.vpage.storage[name].onload();\r\n        }\r\n        else if (type == \"onpop\") {\r\n            $.vpage.storage[name].onpop();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 設定參數\r\n     * @param  name     vpage 的名稱\r\n     * @param  key      參數的鍵\r\n     * @param  val      參數的值\r\n     */\r\n    $.vpage.set = function (name, key, val){\r\n        $.vpage.storage[name][key] = val;\r\n    }\r\n\r\n    /**\r\n     * 取得參數\r\n     * @param  name     vpage 的名稱\r\n     * @param  key      參數的鍵\r\n     */\r\n    $.vpage.get = function (name, key){\r\n        return $.vpage.storage[name][key];\r\n    }\r\n\r\n\r\n    /**\r\n     * [vpage description]\r\n     * @param  param.name                      為該模型命名\r\n     * @param  param.event                     on 的事件\r\n     * @param  param.do(param)                 觸發時的動作\r\n     * @param  param.onload                    畫面進入時所觸發的事件\r\n     * @param  param.onpop                     切換上下頁面所觸發的事件\r\n     * @param  param.state                     (選)history.pushState 物件     \r\n     * @param  param.prepare(param)            (選)觸發事件前的準備動作\r\n     * @param  param.title                     (選)變更的網頁標題\r\n     * @param  param.url                       private 網址不可由外部參數指定。需要透過 $.vpage.set()\r\n     */\r\n    $.fn.vpage = function (param){\r\n\r\n\r\n        $.vpage.api.check_param(param);\r\n\r\n        // 將設定放到倉儲，使用 vpage 的名稱作為鍵\r\n        $.vpage.storage[param.name] = param;\r\n\r\n        // 初次進入，就先將參數放置到 history.state 紀錄\r\n        $.vpage.api.push_state(param);\r\n\r\n        // 綁定使用者指派的事件\r\n        this.on(param.event, function (){\r\n\r\n            // 設定監聽了？\r\n            if ($.vpage.api.is_set_listen() === false) return false;\r\n\r\n            // 判斷自動設定網址\r\n            $.vpage.api.auto_set_url(this, param.name);\r\n\r\n            // 準備動作\r\n            if (param.prepare) param.prepare.call(this, param);\r\n\r\n            // 因為會被動態修改參數，所以要再次覆蓋\r\n            $.vpage.api.push_state(param);\r\n\r\n            // 觸發動作\r\n            if (param.do) return param.do.call(this, param);\r\n        })\r\n\r\n    }\r\n\r\n}( jQuery ));\r\n"]}