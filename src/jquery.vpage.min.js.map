{"version":3,"sources":["jquery.vpage.js"],"names":["$","url_get_onload_key","version","vpage","storage","is_listen","api","this","is_set_listen","console","log","check_param","param","extend","vs","undefined","url","name","event","onload","onpop","err","auto_set_url","usethis","get","tagName","href","attr","set","add_state","state","vpage_name","key","val","history","get_url_param","window","onpopstate","cky","obj","call","push_state","pushdata","pushState","title","sPageURL","location","search","substring","sURLVariables","split","i","length","sParameterName","listen","trigger","type","fn","on","prepare","jQuery"],"mappings":"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","file":"jquery.vpage.min.js","sourcesContent":["(function ( $ ) {\r\n\r\n    var version = \"1.1.0\";\r\n\r\n    // 提供 onload 辨識的鍵，預設 onload \r\n    var url_get_onload_key;\r\n\r\n\r\n\r\n    $.vpage = {};\r\n\r\n    // 倉儲存放\r\n    $.vpage.storage = {}\r\n\r\n    // 是否已經設置監聽\r\n    $.vpage.is_listen = false;\r\n\r\n    $.vpage.api = new function (){\r\n\r\n        // 設定監聽了？\r\n        this.is_set_listen = function (){\r\n            if ($.vpage.is_listen === false) {\r\n                console.log('vpage 還未設定 listen() ');\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        // 確認參數的合法性\r\n        this.check_param = function (param){\r\n            try {\r\n\r\n                // 預設參數\r\n                param = $.extend({\r\n                    vs: this,\r\n                    url_get_onload_key: 'onload'\r\n                }, param);\r\n\r\n                // 禁止輸入 url \r\n                if (param.url !== undefined) throw '請勿指定參數 param.url';\r\n                else if (param.name === undefined) throw '請指定參數 param.name';\r\n                else if (param.event === undefined) throw '請指定參數 param.event';\r\n                else if (param.do === undefined) throw '請指定參數 param.do';\r\n                else if (param.onload === undefined) throw '請指定參數 param.onload';\r\n                else if (param.onpop === undefined) throw '請指定參數 param.onpop';\r\n\r\n                url_get_onload_key = param.url_get_onload_key;\r\n\r\n                // console.log(param)\r\n\r\n            } catch (err){\r\n                console.log('Error: ' + err);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // 如果是標籤 a 就自動設定網址\r\n        this.auto_set_url = function (usethis, name){\r\n            if ($(usethis).get(0).tagName != \"A\") return false;\r\n            var href = $(usethis).attr(\"href\");\r\n\r\n\r\n            $.vpage.set(name, \"url\", href);\r\n            return href;\r\n        }\r\n\r\n        // 添加新的辨識\r\n        this.add_state = function (param){\r\n            if (!param.state) param.state = {};\r\n            param.state.vpage_name = param.name;\r\n            return param.state;\r\n        }\r\n\r\n        // 取得堆中的 vpage 名稱\r\n        this.key = function (key){\r\n            var val = history.state[key].vpage_name;\r\n            return val;\r\n        }\r\n\r\n\r\n\r\n\r\n        \r\n\r\n        /**\r\n         * 畫面進入時所觸發的事件\r\n         * 若要被觸發這個事件，網址需要夾帶有 GET 參數鍵 url_get_onload_key ，值需要指定 vpage 的 name 參數。\r\n         * 例如 http://domain.com?onload=my_button\r\n         */\r\n        this.onload = function (){\r\n\r\n            // 取得 GET 的 onload 值，作為辨識的鍵\r\n            var vpage_name = $.vpage.get_url_param(url_get_onload_key);\r\n\r\n            if (vpage_name) {\r\n\r\n                //呼叫對應的 onload()\r\n                if ($.vpage.storage[vpage_name] !== undefined) {\r\n                    $.vpage.storage[vpage_name].onload();\r\n                }\r\n            }\r\n\r\n            return $.vpage.api;\r\n        }\r\n\r\n        /**\r\n         * 切換上下頁面所觸發的事件\r\n         */\r\n        this.onpop = function (){\r\n\r\n            window.onpopstate  = function (event){\r\n\r\n                //如果有放入堆疊的話才執行\r\n                if (history.state){\r\n                    console.log(history.state)\r\n                    // var cky = $.vpage.get_url_param()\r\n                    var key = $.vpage.api.key(cky);\r\n                    var obj = $.vpage.storage[key];\r\n                    console.log(key)\r\n                    obj.onpop.call();\r\n\r\n                }\r\n                else {\r\n                    // 不應該進入這個判斷。\r\n                    console.log('Default System');\r\n                }\r\n                \r\n            }\r\n            return $.vpage.api;\r\n        }\r\n\r\n        // 將參數放置到 history.state 紀錄\r\n        this.push_state = function (param){\r\n            var vpn = param.name;\r\n            var pushdata = {};\r\n\r\n            param.state = $.vpage.api.add_state(param);\r\n            pushdata[param.name] = param.state;\r\n\r\n            history.pushState(pushdata, param.title, param.url);\r\n            \r\n            // console.log(pushdata);\r\n        }\r\n\r\n    }\r\n\r\n    // 版本\r\n    $.vpage.version = function (){\r\n        return version;\r\n    }\r\n\r\n    // 取得網址的 get 參數，例如 ?\r\n    $.vpage.get_url_param = function (key){\r\n        var sPageURL = window.location.search.substring(1);\r\n        var sURLVariables = sPageURL.split('&');\r\n        for (var i = 0; i < sURLVariables.length; i++){\r\n            var sParameterName = sURLVariables[i].split('=');\r\n            if (sParameterName[0] == key){\r\n                return sParameterName[1];\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 監聽 vpage 設定的 onload 與 onpop 事件，\r\n     * 須要放置在所有的 vpage 最後。\r\n     */\r\n    $.vpage.listen = function(){\r\n        $.vpage.is_listen = true;\r\n        $.vpage.api.onload();\r\n        $.vpage.api.onpop();\r\n    }\r\n\r\n    /**\r\n     * 由外部手動觸發\r\n     * @param   name         vpage 的名稱\r\n     * @param   type         onload | onpop\r\n     */\r\n    $.vpage.trigger = function (name, type){\r\n        if (type == \"onload\"){\r\n            $.vpage.storage[name].onload();\r\n        }\r\n        else if (type == \"onpop\") {\r\n            $.vpage.storage[name].onpop();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 設定參數\r\n     * @param  name     vpage 的名稱\r\n     * @param  key      參數的鍵\r\n     * @param  val      參數的值\r\n     */\r\n    $.vpage.set = function (name, key, val){\r\n        var storage = $.vpage.storage[name];\r\n        if (storage === undefined) {\r\n            console.log('找不到指定的 vpage = ' + name);\r\n            return false;\r\n        }\r\n        $.vpage.storage[name][key] = val;\r\n    }\r\n\r\n    /**\r\n     * 取得參數\r\n     * @param  name     (選)vpage 的名稱，不指定返回全部\r\n     * @param  key      (選)參數的鍵，不指定返回全部\r\n     */\r\n    $.vpage.get = function (name, key){\r\n\r\n        if (name === undefined) return $.vpage.storage;\r\n\r\n        if (key === undefined) {\r\n\r\n            // 找不到 vpage\r\n            var storage = $.vpage.storage[name];\r\n            if (storage === undefined) {\r\n                return false;\r\n            }\r\n\r\n            // 返回所有參數\r\n            return $.vpage.storage[name];\r\n        }\r\n\r\n        return $.vpage.storage[name][key];\r\n    }\r\n\r\n\r\n    /**\r\n     * [vpage description]\r\n     * @param  param.name                      為該模型命名\r\n     * @param  param.event                     on 的事件\r\n     * @param  param.do(param)                 觸發時的動作\r\n     * @param  param.onload                    畫面進入時所觸發的事件\r\n     * @param  param.onpop                     切換上下頁面所觸發的事件\r\n     * @param  param.state                     (選)history.pushState 物件     \r\n     * @param  param.prepare(param)            (選)觸發事件前的準備動作\r\n     * @param  param.title                     (選)變更的網頁標題\r\n     * @param  param.url                       private 網址不可由外部參數指定。需要透過 $.vpage.set()\r\n     */\r\n    $.fn.vpage = function (param){\r\n\r\n        $.vpage.api.check_param(param);\r\n\r\n        // 將設定放到倉儲，使用 vpage 的名稱作為鍵\r\n        $.vpage.storage[param.name] = param;\r\n\r\n        // 初次進入，就先將參數放置到 history.state 紀錄\r\n        if (history.state === null) {\r\n            $.vpage.api.push_state(param);\r\n        }\r\n\r\n\r\n        // 綁定使用者指派的事件\r\n        this.on(param.event, function (){\r\n\r\n\r\n            // 設定監聽了？\r\n            if ($.vpage.api.is_set_listen() === false) return false;\r\n\r\n            // 判斷自動設定網址\r\n            $.vpage.api.auto_set_url(this, param.name);\r\n\r\n            // 準備動作\r\n            if (param.prepare) param.prepare.call(this, param);\r\n\r\n            // 因為會被動態修改參數，所以要再次覆蓋\r\n            $.vpage.api.push_state(param);\r\n\r\n            \r\n\r\n            // 觸發動作\r\n            if (param.do) return param.do.call(this, param);\r\n        })\r\n\r\n    }\r\n\r\n}( jQuery ));\r\n"]}